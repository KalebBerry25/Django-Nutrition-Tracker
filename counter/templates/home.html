<!DOCTYPE html>
<html>
  <head>
    {% load static %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <link href="{% static 'style.css' %}" rel="stylesheet" type="text/css" />
    <title>Nutririon Tracker</title>
  </head>
  <body>
    <div class="container">
      <br><br>
      <br><br>
      <div class = "row justify-content-center"> 
        <div class = "col-md-8 text-center">
          <h1>Nutririon Tracker</h1>
        </div>
      </div>

      <br><br>

      <div style="text-align:center" class="row justify-content-center"> 
        <div class="row gx-5">
          <div class="col-md-4">
            <h3>Search Nutririon Info</h3>
            <form method="POST">
              {%csrf_token%}
              <div class="form-group row">
                <label for="CalorieEntry" class="col-form-label"></label>
                <div class="col-md-12">
                  <div class="input-group input-group-lg">
                    <input type="text" name="query" class="form-control inputstyle" placeholder="Search Food..." required>
                    <button class="btn whoop" type="submit" name="Search">Search</button>
                  </div> 
                </div>
                <div class="col text-center caloriescont shadow">
                  <h2 class="mt-3 mb-4">Nutritional Values</h2><span></span>
                  <ul>
                      <li class="servingsize">Serving Size per 100/Grams<span class="float-end"></span></li>
                      <li>Name: <span class="float-end">{{api.0.name}}</span></li>
                      <li>Calories: <span class="float-end">{{api.0.calories}}</span></li>
                      <li>Carbohydrates: <span class="float-end">{{api.0.carbohydrates_total_g}}</span>
                      </li>
                      <li>Cholesterol: <span class="float-end">{{api.0.cholesterol_mg}}</span></li>
                      <li>Saturated fat: <span class="float-end">{{api.0.fat_saturated_g}}</span></li>
                      <li>Total Fat: <span class="float-end">{{api.0.fat_total_g}}</span></li>
                      <li>Fiber Content: <span class="float-end">{{api.0.fiber_g}}</span></li>
                      <li>Potassium <span class="float-end">{{api.0.potassium_mg}}</span></li>
                      <li>Protein: <span class="float-end">{{api.0.protein_g}}<span></li>
                      <li>Sodium:<span class="float-end">{{api.0.sodium_mg}}</span></li>
                      <li>Sugar: <span class="float-end">{{api.0.sugar_g}}</span></li>
                  </ul>
                </div>
              </div>
            </form>
          </div>
          <div class="col-md-8">
              <h3>Add Food Item</h3>
              <form method="POST">
                {%csrf_token%}
                <div class="form-group row">
                  <label for="CalorieEntry" class="col-form-label"></label>
                  <div class="col-md-12">
                    <div class="input-group input-group-lg">
                      <input type="text" name="query" class="form-control inputstyle" placeholder="Add Food.. Ex. '2 Servings Brisket'" required>
                      <button class="btn whoop" type="submit" name="Add">Add</button>
                    </div> 
                  </div>
                </div>
              </form>
              <br><br>

              <div class = "col">
                <h3 class="mt-3 mb-10" style="text-align:center">Consumption Table</h3>
                <table id="table" class="table">
                    <tr class="bg-info text-white">
                      <th style="text-align:center">Food item</th>
                      <th style="text-align:center">Carbs</th>
                      <th style="text-align:center">Protein</th>
                      <th style="text-align:center">Total Fat</th>
                      <th style="text-align:center">Calories</th>
                      <th style="text-align:center">Remove</th>
                    </tr>

                    {% for c in consumed_foods %}
                    <tr>
                      <td style="text-align:center">{{c.name}}</td>
                      <td style="text-align:center">{{c.carbs}}</td>
                      <td style="text-align:center">{{c.protein}}</td>
                      <td style="text-align:center">{{c.fats}}</td>
                      <td style="text-align:center">{{c.calories}}</td>
                      <td style="text-align:center"><a class="btn btn-danger" href="delete/{{c.id}}">X</a>
                      </td>
                    </tr>
                    {% endfor %}

                    <tr class="bg-info text-white">
                      <td style="text-align:center" id="name"><b>Totals</b></td>
                      <td style="text-align:center" id="totalCarbs"><b></b></td>
                      <td style="text-align:center" id="totalProtien"><b></b></td>
                      <td style="text-align:center" id="totalFats"><b></b></td>
                      <td style="text-align:center" id="totalCalories"><b></b></td>
                    </tr>
                </table>

                <br><br>

              </div>
          </div>
        </div>
      </div>
      <div class = "row justify-content-center">
      
        <div class="col-md-6">

          <div class="card-header text-white bg-info">
            <h4 style="text-align:center">Nutrients Breakdown</h4>
          </div>
          <canvas id="myChart" width="400" height="400"></canvas>

        </div>
      </div>
      
    </div>
    <br><br>




    




  </body>
  <script>
    var table = document.getElementById("table");
    var carbs = 0, protein = 0, fats = 0, calories = 0;

    for (var i = 1; i < table.rows.length - 1; i++) {
        console.log(table.rows[i].cells[1].innerHTML);
        carbs += parseFloat(table.rows[i].cells[1].innerHTML);
        carbs = Math.round(carbs);
        protein += parseFloat(table.rows[i].cells[2].innerHTML);
        protein = Math.round(protein)
        fats += parseFloat(table.rows[i].cells[3].innerHTML);
        fats = Math.round(fats);
        calories += parseFloat(table.rows[i].cells[4].innerHTML);
        calories = Math.round(calories);
    }

    document.getElementById("totalCarbs").innerHTML = '<b>' + carbs + '(gm)</b>';
    document.getElementById("totalProtien").innerHTML = '<b>' + protein + '(gm)</b>';
    document.getElementById("totalFats").innerHTML = '<b>' + fats + '(gm)</b>';
    document.getElementById("totalCalories").innerHTML = '<b>' + calories + '(Kcal)</b>';


    var total = carbs + protein + fats;
    var carbsP = Math.round((carbs / total) * 100);
    var protienP = Math.round((protein / total) * 100);
    var fatsP = Math.round((fats / total) * 100);

    var ctx = document.getElementById('myChart').getContext('2d');


    var myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Carbs ' + carbsP + '%', 'Protein ' + protienP + '%', 'Fats ' + fatsP + '%'],
            datasets: [{
                label: '# of Votes',
                data: [carbsP, protienP, fatsP],
                backgroundColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',

                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',

                ],
                borderWidth: 1
            }]
        },

    });
  </script>





</html>


